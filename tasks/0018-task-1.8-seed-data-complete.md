# TASK 1.8 Completion Summary - Seed Data

**Date:** October 20, 2025  
**Status:** ✅ COMPLETE  
**Time Taken:** ~25 minutes (including debugging)

## What Was Done

Created seed file `005_field_layouts.ts` with realistic field layout data for testing and development. The seed automatically migrates venues to sites if sites don't exist (due to seed execution order).

### Files Created
- `src/db/seeds/005_field_layouts.ts` (264 lines)

### Files Modified
- `src/db/seeds/000_templates.ts` - Skip old pitch templates (deprecated)

## Seed Data Created

### Summary
```
✅ 3 sites (from venues migration)
✅ 6 layouts (2 per site: Match Day + Training)
✅ 18 zones (3 per layout: Main Pitch + Goal Area + Training Zone)
✅ 36 assets (6 per layout: 2 Goals + Center Line + 3 Cones)
✅ 3 templates (Standard Soccer, 7v7 Training, Multi-Zone Complex)
✅ 3 share links (1 permanent, 2 with expiry)
```

## Data Validation

### ✅ Sites (from Venues Migration)
```sql
SELECT id, name FROM sites ORDER BY id
```
**Results:**
- ID 10: Riverside Park
- ID 11: Central Sports Complex  
- ID 12: Willow Field

### ✅ Layouts (2 per Site)
```sql
SELECT l.id, l.name, l.is_published, s.name as site_name 
FROM layouts l JOIN sites s ON l.site_id = s.id 
ORDER BY l.id
```
**Results:**
```
ID 10: Riverside Park - Match Day Setup (published)
ID 11: Riverside Park - Training Setup (draft)
ID 12: Central Sports Complex - Match Day Setup (published)
ID 13: Central Sports Complex - Training Setup (draft)
ID 14: Willow Field - Match Day Setup (published)
ID 15: Willow Field - Training Setup (draft)
```

### ✅ Zones (3 per Layout)
**Per Layout:**
1. **Main Pitch** (105m x 68m = 7,140 m²)
   - Type: `pitch`
   - Surface: `grass`
   - Color: `#22c55e` (green)
   - PostGIS POLYGON boundary

2. **North Goal Area** (18m x 5.5m = 99 m²)
   - Type: `goal_area`
   - Surface: `grass`
   - Color: `#fbbf24` (amber)
   - PostGIS POLYGON boundary

3. **West Training Zone** (20m x 20m = 400 m²)
   - Type: `training_zone`
   - Surface: `turf`
   - Color: `#60a5fa` (blue)
   - PostGIS POLYGON boundary

**Total Zones:** 6 layouts × 3 zones = 18 zones ✓

### ✅ Assets (6 per Layout)
**Per Layout:**
1. **North Goal** (POINT)
   - Type: `goal`
   - Properties: `{ width_m: 7.32, height_m: 2.44, color: '#ffffff' }`

2. **South Goal** (POINT)
   - Type: `goal`
   - Properties: `{ width_m: 7.32, height_m: 2.44, color: '#ffffff' }`

3. **Center Line** (LINESTRING)
   - Type: `line`
   - Properties: `{ width_m: 0.12, color: '#ffffff', line_type: 'solid' }`

4-6. **Training Cones 1-3** (POINT each)
   - Type: `cone`
   - Properties: `{ color: '#f97316', height_m: 0.3 }`

**Total Assets:** 6 layouts × 6 assets = 36 assets ✓

### ✅ Templates (3 Reusable Layouts)
```sql
SELECT id, name, tags, is_public, usage_count FROM templates
```
**Results:**
1. **Standard Soccer Field**
   - Tags: `['soccer', '11v11', 'standard', 'match']`
   - Public: `true`
   - Usage: `15` times

2. **Training Pitch 7v7**
   - Tags: `['soccer', '7v7', 'training', 'small']`
   - Public: `true`
   - Usage: `8` times

3. **Multi-Zone Training Complex**
   - Tags: `['training', 'complex', 'multi-zone', 'drills']`
   - Public: `false` (private)
   - Usage: `3` times

### ✅ Share Links (3 Links)
```sql
SELECT slug, layout_id, expires_at, is_revoked, access_count FROM share_links
```
**Results:**
- `demo1xyz` → Layout 10 (Riverside - Match Day) | Permanent | 0-20 accesses
- `demo2xyz` → Layout 11 (Riverside - Training) | Expires in 60 days | 0-20 accesses
- `demo3xyz` → Layout 12 (Central - Match Day) | Expires in 90 days | 0-20 accesses

## Technical Implementation

### PostGIS Geometry Generation
Zones and assets are positioned relative to each site's location using coordinate offsets:

```typescript
// Site location: POINT(-6.2603 53.3498) - Riverside Park
const lon = -6.2603;
const lat = 53.3498;

// Main pitch boundary (105m x 68m ≈ 0.0012° x 0.0008°)
boundary: ST_GeogFromText('POLYGON((
  ${lon - 0.0006} ${lat - 0.0004},  // SW corner
  ${lon + 0.0006} ${lat - 0.0004},  // SE corner
  ${lon + 0.0006} ${lat + 0.0004},  // NE corner
  ${lon - 0.0006} ${lat + 0.0004},  // NW corner
  ${lon - 0.0006} ${lat - 0.0004}   // Close polygon
))')
```

### Coordinate Offsets
- **Main Pitch:** ±0.0006° lon, ±0.0004° lat (≈105m x 68m at 53°N)
- **Goal Area:** ±0.00012° lon, ±0.00002° lat (≈18m x 5.5m)
- **Training Zone:** ±0.0002° lon, ±0.0002° lat (≈20m x 20m)

### Venues → Sites Migration Integration
The seed file includes embedded migration logic to handle seed execution order:

```typescript
if (sites.length === 0) {
  // Re-run venues→sites migration within seed
  await knex.raw(`INSERT INTO sites (...) SELECT ... FROM venues`);
}
```

This ensures seed works even when `002_venues.ts` clears venues/sites during seed execution.

## Acceptance Criteria Met

- ✅ 3 sites created (from venues migration)
- ✅ 6 layouts distributed across sites (2 per site)
- ✅ 18 zones with valid boundaries (no overlaps within same layout)
- ✅ 36 assets (goals, cones, lines) linked to layouts
- ✅ All geometries valid (ST_IsValid returns TRUE)
- ✅ Seed script is idempotent (deletes old data before inserting)

## Seed Output

```
  ⏭️  Skipping old pitch templates (deprecated)
  → No sites found, migrating from venues...
  ✓ Migrated 3 venues to sites
→ Seeding data for 3 sites...
  ✓ Created 6 layouts
  ✓ Created 18 zones
  ✓ Created 36 assets
  ✓ Created 3 templates
  ✓ Created 3 share links

✅ Seed data created successfully:
   - 3 sites (from migration)
   - 6 layouts
   - 18 zones
   - 36 assets
   - 3 templates
   - 3 share links
Ran 6 seed files
```

## Data Examples for Frontend Testing

### Published Layouts (Match Day Setups)
- Riverside Park - Match Day Setup (ID 10)
- Central Sports Complex - Match Day Setup (ID 12)
- Willow Field - Match Day Setup (ID 14)

### Draft Layouts (Training Setups)
- Riverside Park - Training Setup (ID 11)
- Central Sports Complex - Training Setup (ID 13)
- Willow Field - Training Setup (ID 15)

### Share Links for Testing
```
GET /share/demo1xyz → Riverside Park Match Day (permanent)
GET /share/demo2xyz → Riverside Park Training (expires 60 days)
GET /share/demo3xyz → Central Sports Complex (expires 90 days)
```

### Templates for Browsing
```
GET /templates?tags=soccer → Returns 2 public templates
GET /templates?sort=usage_count → Returns sorted by popularity
```

## Future Enhancements

1. **More Realistic Zones:** Add penalty areas, center circles, corner arcs
2. **Asset Variety:** Add benches, dugouts, scoreboards, lighting
3. **Multi-Sport Templates:** Basketball courts, tennis courts, rugby pitches
4. **Complex Layouts:** Multi-field complexes with shared facilities
5. **Seasonal Variations:** Winter vs summer field configurations

## Test Validations Performed

1. ✅ 3 sites migrated from venues
2. ✅ 6 layouts created (2 per site)
3. ✅ 18 zones with valid PostGIS boundaries
4. ✅ 36 assets with POINT/LINESTRING geometry
5. ✅ 3 templates with JSONB preview_geometry
6. ✅ 3 share links with unique slugs
7. ✅ All counts match expected values
8. ✅ Foreign key relationships valid

## Next Steps

✅ Subtask 1.1 COMPLETE (Sites)  
✅ Subtask 1.2 COMPLETE (Layouts)  
✅ Subtask 1.3 COMPLETE (Zones)  
✅ Subtask 1.4 COMPLETE (Assets)  
✅ Subtask 1.5 COMPLETE (Templates)  
✅ Subtask 1.6 COMPLETE (ShareLinks)  
✅ Subtask 1.7 COMPLETE (Venues → Sites Migration)  
✅ Subtask 1.8 COMPLETE (Seed Data)  
🟢 Proceed to Subtask 1.9: Integration Tests (Schema Validation)

---

**Ready for next subtask:** Yes  
**Blockers:** None  
**Database State:** Fully seeded with realistic test data  
**Progress:** 8/10 subtasks complete (80%) 🎯
